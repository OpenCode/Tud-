services:
  # ----------------------------------------------------
  # 1. SERVIZIO BACKEND (API FastAPI)
  # ----------------------------------------------------
  api:
    container_name: tudu_api
    # Costruisce l'immagine usando il Dockerfile nella cartella ./backend
    build: ./backend
    
    # Mappa la porta 8000
    ports:
      - "8000:8000"
      
    # Persistenza dati
    volumes:
      - ./data:/app/data
    
    restart: always

  # ----------------------------------------------------
  # 2. SERVIZIO FRONTEND (Nginx + Vue)
  # ----------------------------------------------------
  frontend:
    container_name: tudu_frontend
    image: nginx:stable-alpine
    
    # Mappa la porta 8080 (browser) alla 80 (container)
    ports:
      - "8080:80"
    
    # Monta i file del frontend e la config di Nginx
    volumes:
      - ./frontend:/usr/share/nginx/html:ro
      - ./frontend/default.conf:/etc/nginx/conf.d/default.conf:ro

    depends_on:
      - api
    
    restart: always
